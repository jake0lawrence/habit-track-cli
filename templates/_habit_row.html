<table>
  <thead>
    <tr>
      <th>Habit</th>
      {% for day in week %}
        <th>{{ day.strftime('%a') }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for key, info in habits.items() %}
      {% set label = info.label %}
      <tr>
        <td>{{ label }}</td>
        {% for day in week %}
          {% set entry = data.get(day|string, {}).get(key) %}
          <td class="{{ 'cell-done' if entry else 'cell-empty' }}">
            {% if day|string == today %}
              {% if entry is mapping %}
                <div class="entry-summary">
                  ✅ {{ entry.duration }} min
                  {% if entry.note %}
                    <div class="entry-note">📝 {{ entry.note }}</div>
                  {% endif %}
                  <button
                    class="edit-button"
                    @click.prevent="
                      showModal = true;
                      form.habit = '{{ key }}';
                      form.label = '{{ label }}';
                      form.duration = '{{ entry.duration }}';
                      form.note = `{{ entry.note | e }}`;
                    "
                    title="Edit entry"
                  >🖉</button>
                </div>
              {% else %}
                <button
                  @click.prevent="
                    showModal = true;
                    form.habit = '{{ key }}';
                    form.label = '{{ label }}';
                    form.duration = localStorage.getItem(`${form.habit}_duration`) || {{ info.default_duration }};
                    form.note = localStorage.getItem(`${form.habit}_note`) || '';
                  "
                  class="log-button"
                >Log</button>
              {% endif %}
            {% else %}
              {% if entry is mapping %}
                <div class="entry-summary">
                  ✅ {{ entry.duration }} min
                  {% if entry.note %}
                    <div class="entry-note">📝 {{ entry.note }}</div>
                  {% endif %}
                </div>
              {% else %}
                –
              {% endif %}
            {% endif %}
          </td>
        {% endfor %}
      </tr>
    {% endfor %}
  </tbody>
</table>
